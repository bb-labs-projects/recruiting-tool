---
phase: 04-employer-onboarding-and-browse
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/app/admin/employers/page.tsx
  - src/app/admin/employers/columns.tsx
  - src/app/admin/employers/data-table.tsx
  - src/app/admin/employers/[id]/page.tsx
  - src/components/admin/employer-actions.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can see a table of all employer accounts with status"
    - "Admin can approve a pending employer account"
    - "Admin can reject a pending employer account with a reason"
    - "Admin can view individual employer detail with company info"
    - "Employer status changes are reflected immediately after action"
  artifacts:
    - path: "src/app/admin/employers/page.tsx"
      provides: "Admin employer list page with TanStack Table"
      min_lines: 20
    - path: "src/app/admin/employers/columns.tsx"
      provides: "TanStack Table column definitions for employer rows"
      min_lines: 30
    - path: "src/app/admin/employers/data-table.tsx"
      provides: "Client-side DataTable wrapper for employer management"
      min_lines: 40
    - path: "src/app/admin/employers/[id]/page.tsx"
      provides: "Employer detail page with approve/reject actions"
      min_lines: 30
    - path: "src/components/admin/employer-actions.tsx"
      provides: "Approve/reject button components for employer management"
      min_lines: 30
  key_links:
    - from: "src/app/admin/employers/page.tsx"
      to: "src/lib/dal/admin-employers.ts"
      via: "getAllEmployerProfiles DAL function"
      pattern: "getAllEmployerProfiles"
    - from: "src/components/admin/employer-actions.tsx"
      to: "src/actions/employers.ts"
      via: "approveEmployer and rejectEmployer server actions"
      pattern: "(approveEmployer|rejectEmployer)"
---

<objective>
Build the admin employer management interface so admins can view, approve, and reject employer accounts.

Purpose: This satisfies ADMN-02: "Admin can approve, manage, and view activity of approved employers." Admins need a clear queue of pending employers and the ability to approve/reject with feedback.

Output: Admin employer list page with TanStack Table (same pattern as admin candidates), employer detail page, and approve/reject action components.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-employer-onboarding-and-browse/04-RESEARCH.md

@src/app/admin/candidates/page.tsx
@src/app/admin/candidates/columns.tsx
@src/app/admin/candidates/data-table.tsx
@src/app/admin/candidates/[id]/page.tsx
@src/app/admin/layout.tsx

Prior plan summary (for schema/DAL/actions context):
@.planning/phases/04-employer-onboarding-and-browse/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Admin employer list page with TanStack Table</name>
  <files>
    src/app/admin/employers/page.tsx
    src/app/admin/employers/columns.tsx
    src/app/admin/employers/data-table.tsx
  </files>
  <action>
    1. Create `src/app/admin/employers/columns.tsx` (NEW):
       - 'use client' directive
       - Follow the EXACT same pattern as `src/app/admin/candidates/columns.tsx`
       - Define `EmployerRow` type: { id: string, companyName: string, contactName: string, contactTitle: string | null, status: 'pending' | 'approved' | 'rejected', createdAt: string, reviewedAt: string | null, userEmail: string }
       - Column definitions:
         - companyName: sortable header, cell links to `/admin/employers/${row.original.id}` with font-medium hover:underline
         - contactName: plain text cell
         - userEmail: plain text cell, text-muted-foreground
         - status: use a Badge component (not the StatusBadge from candidates -- employer statuses are different). Pending = yellow/amber, approved = green, rejected = red. Use Badge variant="outline" with custom colors via className.
         - createdAt: sortable header, formatted as toLocaleDateString()
       - Export `columns` array

    2. Create `src/app/admin/employers/data-table.tsx` (NEW):
       - 'use client' directive
       - Follow the EXACT same pattern as `src/app/admin/candidates/data-table.tsx`
       - DataTable generic component with sorting, column filters, global filter, pagination
       - Search input placeholder: "Search employers..."
       - Status filter dropdown: "All", "Pending", "Approved", "Rejected"
       - Default sort: createdAt desc (newest first)
       - Global filter searches companyName and userEmail
       - Use the same shadcn Table, Input, Button, Select imports
       - Pagination with previous/next buttons and page count

    3. Create `src/app/admin/employers/page.tsx` (NEW):
       - Server component (async)
       - Import `getAllEmployerProfiles` from '@/lib/dal/admin-employers'
       - Import `columns` from './columns', `DataTable` from './data-table'
       - Fetch all employer profiles
       - Transform data to match EmployerRow type (ensure createdAt is ISO string, reviewedAt is ISO string or null)
       - Render:
         - Page title: "Employer Management"
         - Subtitle: "Review and manage employer accounts"
         - Summary cards row (optional, lightweight): count of pending, approved, rejected
         - DataTable with columns and data
       - The admin layout already handles auth check (role === 'admin'), so no need to re-check here
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm all employer admin files compile. Verify column definitions match the EmployerRow type.
  </verify>
  <done>
    - Admin employer list page renders a TanStack Table with all employer accounts
    - Table supports sorting, searching by company name/email, and filtering by status
    - Company name links to employer detail page
    - Status shown as colored badge (pending=yellow, approved=green, rejected=red)
  </done>
</task>

<task type="auto">
  <name>Task 2: Employer detail page and approve/reject actions</name>
  <files>
    src/app/admin/employers/[id]/page.tsx
    src/components/admin/employer-actions.tsx
  </files>
  <action>
    1. Create `src/components/admin/employer-actions.tsx` (NEW):
       - 'use client' directive
       - Follow the same pattern as `src/app/admin/candidates/[id]/profile-actions.tsx`
       - Import useTransition from 'react' (same approach as profile approve/reject in Phase 3)
       - Import approveEmployer, rejectEmployer from '@/actions/employers'
       - Import Button from ui/button, Textarea from ui/textarea
       - Import useState for rejection reason input

       - Export `ApproveEmployerButton({ employerProfileId }: { employerProfileId: string })`:
         - useTransition for pending state
         - Form with hidden input for employerProfileId
         - Green-tinted approve button: "Approve Employer"
         - Shows "Approving..." while pending
         - Calls approveEmployer server action

       - Export `RejectEmployerButton({ employerProfileId }: { employerProfileId: string })`:
         - useTransition for pending state
         - useState for rejectionReason text
         - Textarea for rejection reason (required, placeholder: "Reason for rejection...")
         - Red-tinted reject button: "Reject Employer"
         - Shows "Rejecting..." while pending
         - Calls rejectEmployer server action with employerProfileId + rejectionReason
         - Button disabled if rejectionReason is empty

    2. Create `src/app/admin/employers/[id]/page.tsx` (NEW):
       - Server component (async)
       - Import db and employerProfiles, users from schema
       - Import eq from drizzle-orm
       - Fetch employer profile by id (params.id) with a join to get user email
       - If not found, import notFound from 'next/navigation' and call it
       - Render employer detail:
         - Back link to /admin/employers
         - Company name as page title
         - Status badge (same as in columns.tsx)
         - Detail grid showing: Company Name, Company Website (linked), Contact Name, Contact Title, Phone, Email (from users join), Status, Created At, Reviewed At
         - If status is 'pending': show both ApproveEmployerButton and RejectEmployerButton
         - If status is 'approved': show green "Approved" indicator with reviewedAt date
         - If status is 'rejected': show red "Rejected" indicator with rejectionReason and reviewedAt date
       - Use Card/CardHeader/CardContent for the detail layout
       - Use Separator between sections if needed
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm employer detail page and action components compile. Verify that approve/reject buttons pass correct employerProfileId.
  </verify>
  <done>
    - Admin can view full employer details on the detail page
    - Pending employers show approve and reject buttons
    - Approve button calls approveEmployer action and page revalidates
    - Reject button requires a reason and calls rejectEmployer action
    - Already-approved and already-rejected employers show appropriate status indicators
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Admin employer list page shows all employer accounts with correct status badges
3. Table supports search, sort, and status filter
4. Employer detail page shows all company info fields
5. Approve/reject buttons work with proper server action integration
6. Rejection requires a reason (button disabled without text)
7. Pattern consistency with admin candidates pages (same TanStack Table, same button patterns)
</verification>

<success_criteria>
- ADMN-02 requirement satisfied: admin can approve, manage employer accounts
- TanStack Table with search, sort, filter matches admin candidates pattern
- Approve/reject flow follows same useTransition pattern as profile actions in Phase 3
- Employer detail page shows company info, status, and relevant actions
- Status changes trigger revalidation so list updates immediately
</success_criteria>

<output>
After completion, create `.planning/phases/04-employer-onboarding-and-browse/04-03-SUMMARY.md`
</output>
