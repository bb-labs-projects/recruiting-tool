---
phase: 07-candidate-self-service
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/app/(authenticated)/candidate/nav.tsx
  - src/app/(authenticated)/candidate/layout.tsx
  - src/app/(authenticated)/candidate/page.tsx
autonomous: true

must_haves:
  truths:
    - "Candidate layout verifies role and renders navigation"
    - "CandidateNav shows Dashboard, My Profile, and Upload CV links with active state highlighting"
    - "Dashboard shows profile status summary when profile exists"
    - "Dashboard shows 'Upload your CV' CTA when no profile exists"
  artifacts:
    - path: "src/app/(authenticated)/candidate/nav.tsx"
      provides: "CandidateNav client component with active link highlighting"
      exports: ["CandidateNav"]
    - path: "src/app/(authenticated)/candidate/layout.tsx"
      provides: "Candidate layout with role check and CandidateNav"
      min_lines: 15
    - path: "src/app/(authenticated)/candidate/page.tsx"
      provides: "Dashboard page with profile status awareness"
      min_lines: 40
  key_links:
    - from: "src/app/(authenticated)/candidate/layout.tsx"
      to: "src/lib/dal.ts"
      via: "getUser() for role verification"
      pattern: "getUser"
    - from: "src/app/(authenticated)/candidate/page.tsx"
      to: "src/lib/dal/candidate-profiles.ts"
      via: "getCandidateProfile for profile status display"
      pattern: "getCandidateProfile"
    - from: "src/app/(authenticated)/candidate/layout.tsx"
      to: "src/app/(authenticated)/candidate/nav.tsx"
      via: "renders CandidateNav component"
      pattern: "CandidateNav"
---

<objective>
Create the candidate navigation, layout, and profile-aware dashboard.

Purpose: Candidates need a proper navigation experience (currently a pass-through layout with placeholder page). The dashboard must be profile-status-aware: showing a "Upload your CV" CTA when no profile exists, and a profile status summary (pending_review/active/rejected) when one does. This mirrors the employer layout pattern but for candidates.

Output: CandidateNav component, updated candidate layout with role check and nav, and profile-aware dashboard page.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-candidate-self-service/07-RESEARCH.md
@src/app/(authenticated)/employer/nav.tsx
@src/app/(authenticated)/employer/layout.tsx
@src/app/(authenticated)/candidate/layout.tsx
@src/app/(authenticated)/candidate/page.tsx
@src/lib/dal/candidate-profiles.ts
@src/lib/dal.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CandidateNav component and update candidate layout</name>
  <files>src/app/(authenticated)/candidate/nav.tsx, src/app/(authenticated)/candidate/layout.tsx</files>
  <action>
    **1. Create `src/app/(authenticated)/candidate/nav.tsx`:**

    Mirror the EmployerNav pattern from `src/app/(authenticated)/employer/nav.tsx` exactly. This is a 'use client' component.

    Nav links:
    - `{ href: '/candidate', label: 'Dashboard', icon: LayoutDashboard, exact: true }`
    - `{ href: '/candidate/profile', label: 'My Profile', icon: FileText, exact: true }`
    - `{ href: '/candidate/upload', label: 'Upload CV', icon: Upload, exact: true }`

    Import icons from lucide-react: `LayoutDashboard`, `FileText`, `Upload`.
    Import `cn` from `@/lib/utils`.
    Use identical styling as EmployerNav: `border-b bg-background px-6`, `h-10 items-center gap-6`, same active/inactive text classes.

    Export `CandidateNav` as a named export.

    **2. Update `src/app/(authenticated)/candidate/layout.tsx`:**

    Replace the current pass-through layout. Mirror the EmployerLayout pattern from `src/app/(authenticated)/employer/layout.tsx`:
    - Import `getUser` from `@/lib/dal`
    - Import `redirect` from `next/navigation`
    - Import `CandidateNav` from `./nav`
    - Make it an async server component
    - Call `getUser()`, if !user or user.role !== 'candidate', redirect to '/login'
    - Render `<div><CandidateNav /><div className="p-6">{children}</div></div>`

    Add a JSDoc comment explaining the layout follows the employer layout pattern, with role verification. Note that auth is already verified by the parent (authenticated) layout.
  </action>
  <verify>
    Run `npx tsc --noEmit`. Verify CandidateNav exports correctly. Verify layout imports CandidateNav and performs role check.
  </verify>
  <done>
    CandidateNav component exists with Dashboard/My Profile/Upload CV links with active state highlighting. Candidate layout verifies role=candidate and renders CandidateNav + children with padding.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace candidate dashboard with profile-status-aware page</name>
  <files>src/app/(authenticated)/candidate/page.tsx</files>
  <action>
    Replace the current placeholder dashboard page with a profile-status-aware dashboard.

    This is a server component (async). Import `getUser` from `@/lib/dal` and `getCandidateProfile` from `@/lib/dal/candidate-profiles`.

    **Logic flow:**
    1. Get user via `getUser()`
    2. Get profile via `getCandidateProfile(user.id)`
    3. Render different content based on profile state:

    **Case A: No profile exists (`profile === null`)**
    - Show a welcoming header: "Welcome to the IP Lawyer Network"
    - Show a prominent Card with:
      - CardTitle: "Complete Your Profile"
      - CardDescription: "Upload your CV to create your professional profile. Our system will automatically extract your qualifications, experience, and specializations."
      - A Button (as Link) pointing to `/candidate/upload`: "Upload Your CV" with Upload icon
    - Show a secondary Card explaining the process: "How it works" with 3 steps:
      1. Upload your CV (PDF format)
      2. Our system extracts your professional details
      3. Review and submit for approval

    **Case B: Profile exists**
    - Show header: "Candidate Dashboard" with user email subtitle
    - Show a profile summary Card with:
      - Profile name (from profile.name)
      - Status badge: color-coded based on profile.status
        - pending_review: amber/yellow "Pending Review"
        - active: green "Active"
        - rejected: red "Rejected"
      - If rejected and profile.rejectionNotes: show the rejection notes in a muted text block
    - Show stats in a grid (2 cols on sm, 3 on lg):
      - Specializations count (from profile.profileSpecializations.length)
      - Work history entries count
      - Education entries count
    - Show a Link to `/candidate/profile`: "View & Edit Profile"
    - If status is 'rejected': show a note "You can edit your profile and resubmit for review"

    Use Card, CardContent, CardHeader, CardTitle, CardDescription from '@/components/ui/card'.
    Use Button from '@/components/ui/button'.
    Use Badge from '@/components/ui/badge'.
    Use Link from 'next/link'.
    Import icons: Upload, FileText, CheckCircle, Clock, XCircle, Briefcase, GraduationCap, Scale from lucide-react.
  </action>
  <verify>
    Run `npx tsc --noEmit`. Verify the page renders different content based on whether a profile exists. Verify it calls getCandidateProfile and handles both null and non-null cases.
  </verify>
  <done>
    Dashboard page shows "Upload your CV" CTA when no profile exists, and profile status summary (name, status badge, stats, quick links) when a profile exists. Rejected profiles show rejection notes and re-submission guidance.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- CandidateNav has three links: Dashboard, My Profile, Upload CV
- Candidate layout verifies role=candidate and renders nav
- Dashboard calls getCandidateProfile and conditionally renders upload CTA vs profile summary
- Status badges use correct colors for pending_review/active/rejected
</verification>

<success_criteria>
Candidate experience has proper navigation with active state highlighting. Layout verifies candidate role. Dashboard is profile-aware: shows upload CTA for new candidates and profile summary with status for existing candidates.
</success_criteria>

<output>
After completion, create `.planning/phases/07-candidate-self-service/07-03-SUMMARY.md`
</output>
