---
phase: 01-foundation-and-auth
plan: 04
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/app/(public)/layout.tsx
  - src/app/(public)/login/page.tsx
  - src/app/(public)/auth/verify/page.tsx
  - src/app/(authenticated)/layout.tsx
  - src/app/(authenticated)/candidate/layout.tsx
  - src/app/(authenticated)/candidate/page.tsx
  - src/app/(authenticated)/employer/layout.tsx
  - src/app/(authenticated)/employer/page.tsx
  - src/app/admin/layout.tsx
  - src/app/admin/page.tsx
  - src/app/layout.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Visiting / redirects to /login (or role-based dashboard if authenticated)"
    - "The /login route renders within the public layout"
    - "The /auth/verify route renders within the public layout"
    - "The /candidate route renders within the authenticated layout and shows candidate content"
    - "The /employer route renders within the authenticated layout and shows employer content"
    - "The /admin route renders with admin layout and shows admin content"
    - "Authenticated layout calls DAL to verify session before rendering children"
    - "Admin layout calls DAL to verify admin role before rendering children"
  artifacts:
    - path: "src/app/(public)/layout.tsx"
      provides: "Centered, minimal layout for public pages"
      min_lines: 10
    - path: "src/app/(authenticated)/layout.tsx"
      provides: "Auth-verified layout with user context"
      min_lines: 15
    - path: "src/app/admin/layout.tsx"
      provides: "Admin-verified layout with sidebar"
      min_lines: 15
    - path: "src/app/(authenticated)/candidate/page.tsx"
      provides: "Candidate dashboard placeholder"
      min_lines: 5
    - path: "src/app/(authenticated)/employer/page.tsx"
      provides: "Employer dashboard placeholder"
      min_lines: 5
    - path: "src/app/admin/page.tsx"
      provides: "Admin dashboard placeholder"
      min_lines: 5
  key_links:
    - from: "src/app/(authenticated)/layout.tsx"
      to: "src/lib/dal.ts"
      via: "getUser import for session verification"
      pattern: "import.*getUser.*dal"
    - from: "src/app/admin/layout.tsx"
      to: "src/lib/dal.ts"
      via: "getUser import for admin role check"
      pattern: "import.*getUser.*dal"
    - from: "src/app/page.tsx"
      to: "/login"
      via: "redirect to login"
      pattern: "redirect.*login"
---

<objective>
Create the complete route group structure with layouts and placeholder pages for all three role-based areas.

Purpose: Establish the application's routing skeleton -- public routes (login, verify), authenticated routes (candidate, employer), and admin routes. Each area has its own layout with appropriate auth checks. This gives the auth UI (Plan 05) a structure to render within.

Output: 12 route files defining the application's complete page structure with role-based layouts.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation-and-auth/01-RESEARCH.md

Depends on Plan 01-02 artifacts:
- src/lib/dal.ts (getUser, verifySession)

Route group structure from research:
- (public)/ -- no auth required, centered layout
- (authenticated)/ -- shared auth check in layout
  - candidate/ -- candidate-specific layout + pages
  - employer/ -- employer-specific layout + pages
- admin/ -- NOT a route group (explicit /admin URL path), separate admin auth check

Key patterns:
- Route groups with () do NOT affect the URL path
- Auth checks go in page components and DAL, NOT exclusively in layouts (layouts don't re-render on navigation)
- Admin route is NOT in (authenticated) group -- it has its own layout with admin-specific role check
- Layouts fetch user data for display; pages do the security-critical checks
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create route groups, layouts, and root page</name>
  <files>
    src/app/layout.tsx
    src/app/page.tsx
    src/app/(public)/layout.tsx
    src/app/(authenticated)/layout.tsx
    src/app/admin/layout.tsx
  </files>
  <action>
    1. Update `src/app/layout.tsx` (root layout):
       - Keep the existing root layout structure from create-next-app
       - Ensure it imports globals.css
       - Set metadata: title = "IP Lawyer Recruiting", description = "Connect IP lawyers with opportunities"
       - Body should render {children} with basic font setup (Inter or system font)
       - This layout does NOT do any auth checks -- it wraps everything

    2. Replace `src/app/page.tsx` (root page):
       - Import redirect from 'next/navigation'
       - Import decrypt from '@/lib/auth/session'
       - Import cookies from 'next/headers'
       - On server render:
         - Read session cookie and decrypt
         - If valid session with role: redirect to role-based dashboard (/admin, /employer, /candidate)
         - If no session: redirect to /login
       - This page never renders UI -- it's purely a redirect router

    3. Create `src/app/(public)/layout.tsx`:
       - Simple centered layout for login/verify pages
       - Tailwind: min-h-screen, flex items-center justify-center, bg-gray-50 (or similar neutral)
       - Wraps children in a centered container with max-w-md and padding
       - No auth checks -- public routes are accessible to everyone
       - Optionally show the app name at the top

    4. Create `src/app/(authenticated)/layout.tsx`:
       - Import getUser from '@/lib/dal'
       - Import redirect from 'next/navigation'
       - This is an async server component
       - Call getUser() -- if it returns null, redirect('/login')
       - Note: getUser() internally calls verifySession() which already redirects if no session. The null check is a safety net.
       - Render a basic app shell: header with app name + user email + logout button area, then {children}
       - Pass user data to children via the layout markup (not context -- server components don't use React context)
       - The header should be a simple bar with the app name on the left and a placeholder for the logout button on the right

    5. Create `src/app/admin/layout.tsx`:
       - Import getUser from '@/lib/dal'
       - Import redirect from 'next/navigation'
       - Async server component
       - Call getUser(). If null OR role !== 'admin', redirect('/login')
       - Render admin layout: sidebar (left) with navigation links + main content area
       - Sidebar links (placeholder for now): Dashboard, Candidates, Employers, Analytics
       - Header with "Admin" badge and user email
       - Style with Tailwind: flex layout, sidebar w-64 bg-gray-900 text-white, main content flex-1
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Root page.tsx redirects (never renders UI)
    - (public)/layout.tsx renders centered container with no auth
    - (authenticated)/layout.tsx calls getUser() and redirects if null
    - admin/layout.tsx calls getUser() and checks role === 'admin'
    - All layouts accept and render {children}
  </verify>
  <done>
    Root layout, root redirect page, and three area layouts are in place. Public layout is open. Authenticated layout verifies session via DAL. Admin layout verifies admin role via DAL.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create public placeholder pages (login, verify)</name>
  <files>
    src/app/(public)/login/page.tsx
    src/app/(public)/auth/verify/page.tsx
  </files>
  <action>
    1. Create `src/app/(public)/login/page.tsx`:
       - For now, render a simple placeholder: "Login page - magic link form goes here"
       - Use shadcn Card component to wrap the placeholder
       - This will be replaced with the actual MagicLinkForm in Plan 05
       - Export metadata: { title: 'Sign In' }

    2. Create `src/app/(public)/auth/verify/page.tsx`:
       - For now, render a simple placeholder: "Verify page - token confirmation goes here"
       - Use shadcn Card component
       - This will be replaced with the actual verify UI in Plan 05
       - Export metadata: { title: 'Verify Login' }
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - /login renders the placeholder login page within the centered public layout
    - /auth/verify renders the placeholder verify page within the centered public layout
    - Both pages use shadcn Card components for visual structure
  </verify>
  <done>
    Login and verify placeholder pages exist within the public route group and render inside the centered layout. Ready for Plan 05 to replace with real auth components.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create authenticated area pages (candidate, employer, admin)</name>
  <files>
    src/app/(authenticated)/candidate/layout.tsx
    src/app/(authenticated)/candidate/page.tsx
    src/app/(authenticated)/employer/layout.tsx
    src/app/(authenticated)/employer/page.tsx
    src/app/admin/page.tsx
  </files>
  <action>
    1. Create `src/app/(authenticated)/candidate/layout.tsx`:
       - Simple pass-through layout (just renders children)
       - Could add candidate-specific navigation later
       - For now: a wrapper div with appropriate padding

    2. Create `src/app/(authenticated)/candidate/page.tsx`:
       - Import getUser from '@/lib/dal'
       - Async server component
       - Call getUser() to get user data
       - Render: heading "Candidate Dashboard", welcome message with user email
       - Show placeholder cards: "My Profile", "Job Matches", "Settings"
       - Use shadcn Card components for visual structure
       - This is a real page (not just a placeholder string) -- it should look like a dashboard skeleton

    3. Create `src/app/(authenticated)/employer/layout.tsx`:
       - Simple pass-through layout (renders children)
       - Wrapper div with appropriate padding

    4. Create `src/app/(authenticated)/employer/page.tsx`:
       - Import getUser from '@/lib/dal'
       - Async server component
       - Call getUser() to get user data
       - Render: heading "Employer Dashboard", welcome message with user email
       - Show placeholder cards: "Browse Candidates", "Saved Profiles", "My Jobs"
       - Use shadcn Card components

    5. Create `src/app/admin/page.tsx`:
       - Import getUser from '@/lib/dal'
       - Import redirect from 'next/navigation'
       - Async server component
       - Call getUser(). If role !== 'admin', redirect('/login')
       - Render: heading "Admin Dashboard", welcome message
       - Show placeholder cards: "Candidates" (count), "Employers" (count), "Revenue" (amount)
       - These are placeholder values for now -- real data comes in later phases
       - Use shadcn Card components

       IMPORTANT: Even though admin/layout.tsx already checks role, the page also checks. This is defense-in-depth: layouts don't re-render on client-side navigation, so the page-level check is the security boundary.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` (or at least dev mode) can render these pages without errors
    - /candidate renders candidate dashboard with user data from getUser()
    - /employer renders employer dashboard with user data from getUser()
    - /admin renders admin dashboard with role check
    - All pages use shadcn Card components for visual structure
  </verify>
  <done>
    Candidate, employer, and admin dashboards show role-appropriate content with user data from the DAL. Admin page has defense-in-depth role check. All authenticated area pages render correctly within their respective layouts.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes across all route files
2. Route structure matches:
   - (public)/login/page.tsx
   - (public)/auth/verify/page.tsx
   - (authenticated)/candidate/page.tsx
   - (authenticated)/employer/page.tsx
   - admin/page.tsx
3. Authenticated layout calls getUser() from DAL
4. Admin layout checks role === 'admin'
5. Admin page has redundant role check (defense-in-depth)
6. Root page.tsx redirects to /login or role-based dashboard
7. All pages use shadcn Card components for structure
</verification>

<success_criteria>
- Visiting / redirects appropriately (to /login when unauthenticated)
- /login and /auth/verify render within centered public layout
- /candidate and /employer render within authenticated layout with header
- /admin renders within admin layout with sidebar
- Non-admin cannot see admin page (redirected by both layout and page checks)
- Each role area shows a dashboard skeleton with placeholder cards
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-auth/01-04-SUMMARY.md`
</output>
